function startDemo(e){let o=loadConfig();console.log(`Versão do SDK Facetec: ${e.versaoSdkFacetec}`),console.log(`Versão do SDK: ${e.versaoSdk}`),e.shouldEnableIframeOnly=window.self!==window.top,e.botaoCancelar=o.botaoCancelar,e.facetecResourcesPath="../facetec-sdk",e.vocalGuidancePath="../vocalGuidance",e.logoApp=o.imageBase64,e.wizzard=!0,document.documentElement.style.setProperty("--cor-primary",o.wizardCorPrimary),document.documentElement.style.setProperty("--cor-textCorpo",o.wizardCorTextCorpo),document.documentElement.style.setProperty("--cor-textTitle",o.wizardCorTextTitle),document.documentElement.style.setProperty("--cor-textButton",o.wizardCorTextButton),document.documentElement.style.setProperty("--button-radius",o.wizardButtonRadius),document.documentElement.style.setProperty("--cor-background",o.backgroundColor),e.loadingSpinnerColor=o.wizardCorPrimary,e.backgroundColor=o.backgroundColor,e.btnNormalColor=o.btnNormalColor,e.loadingTextColor=o.loadingTextColor,e.btnHighlightColor=o.btnHighlightColor,e.btnDisabledColor=o.btnDisabledColor,e.btnBorderColor=o.btnBorderColor,e.btnBorderWidth=o.btnBorderWidth,e.btnBorderRadius=o.btnBorderRadius,e.ovalStrokeColor=o.ovalStrokeColor,e.ovalProgressColor1=o.ovalProgressColor1,e.ovalProgressColor2=o.ovalProgressColor2,e.buttonTextColor=o.wizardCorTextButton,e.resultAnimationSuccessBackgroundColor=o.resultAnimationSuccessBackgroundColor,e.resultAnimationSuccessForegroundColor=o.resultAnimationSuccessForegroundColor,e.resultAnimationSuccessBackgroundImage=o.resultAnimationSuccessBackgroundImage,e.successBackgroundColor=o.successBackgroundColor,e.retryScreenHeaderTextColor=o.retryScreenHeaderTextColor,e.retryScreenSubtextTextColor=o.retryScreenSubtextTextColor,e.retryScreenImageBorderWidth=o.retryScreenImageBorderWidth,e.readyScreenHeaderTextColor=o.readyScreenHeaderTextColor,e.readyScreenSubtextColor=o.readyScreenSubtextColor,e.feedbackCustomizationBackgroundColor=o.feedbackCustomizationBackgroundColor,e.feedbackCustomizationTextColor=o.feedbackCustomizationTextColor,e.feedbackCustomizationCornerRadius=o.feedbackCustomizationCornerRadius,e.feedbackCustomizationShadow=o.feedbackCustomizationShadow,e.loadingBackgroundColor=o.loadingBackgroundColor,e.uploadProgressFillColor=o.uploadProgressFillColor,e.conexaoTimeout=o.conexaoTimeout,e.iniciaSelfie(document.getElementById("selfie"),(e=>{console.log("callback",e)})).then((e=>{console.log(e),hideLoginContainer(),showResultContainer();document.getElementById("jsonResult").textContent=JSON.stringify(e),document.getElementById("imgA").src="data:image/jpeg;base64,"+e.selfie})).catch((e=>{9==e.id&&(deleteCookie("bearerToken"),deleteCookie("legacyToken")),hideLoginContainer(),showResultContainer();document.getElementById("jsonResult").textContent=JSON.stringify(e),console.log("err",e)}))}function clearCookies(){document.cookie.split(";").forEach((function(e){document.cookie=e.replace(/^ +/,"").replace(/=.*/,"=;expires="+(new Date).toUTCString()+";path=/")}))}function deleteCookie(e){document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"}function hideLoginContainer(){document.getElementById("login").style.display="none"}function hideResultContainer(){document.getElementById("sdkResult").style.display="none",document.getElementById("imgA").src="",document.getElementById("imgB").src="",document.getElementById("jsonResult").textContent=""}function showLoginContainer(){document.getElementById("login").style.display="block"}function showResultContainer(){document.getElementById("sdkResult").style.display="block"}function getSerasaIamUrl(e){return`${BASE_URL}/security/iam/v1/user-identities/login?clientId=${e}`}function getClientTokenURL(){return`${BASE_URL}/security/iam/v1/client-identities/login`}function disableAllButtons(){document.querySelectorAll("button").forEach((e=>{e.disabled=!0}))}function enableAllButtons(){document.querySelectorAll("button").forEach((e=>{e.disabled=!1}))}function setCookie(e,o){const t=new Date;t.setTime(t.getTime()+36e5);const n="expires="+t.toUTCString();document.cookie=e+"="+o+";"+n+";path=/"}function getCookie(e){const o=e+"=",t=document.cookie.split(";");for(let e=0;e<t.length;e++){let n=t[e];for(;" "===n.charAt(0);)n=n.substring(1,n.length);if(0===n.indexOf(o))return n.substring(o.length,n.length)}return null}async function getToken(e,o,t){return new Promise((async(n,r)=>{let l=new Headers;l.append("Authorization","Basic "+btoa(o+":"+t));let a=await fetch(e,{method:"POST",headers:l});try{n((await a.json()).accessToken)}catch(e){console.log("ex",e),r({id:"INVALID_AUTHENTICATION",desc:"Erro ao gerar token. Por favor, verifique as credenciais e tente novamente."})}}))}function initApp(){const e=getCookie("bearerToken");if(document.getElementById("iframe-button").hidden=window.self!==window.top,hideResultContainer(),e){hideLoginContainer(),startDemo(new window.BrScanSDKSelfie.Selfie(e,""))}else showLoginContainer(),console.log("Nenhum token encontrado, redirecionando para login.")}document.getElementById("legacyButton").addEventListener("click",(function(){var e=document.getElementById("legacyKey").value,o=document.getElementById("error-message");if(""===e)o.style.display="block",o.textContent="Por favor, preencha o campo com a chave legada";else{o.style.display="none",o.textContent="",startDemo(new window.BrScanSDKSelfie.Selfie(e))}})),document.getElementById("loginButton").addEventListener("click",(function(){var e=document.getElementById("clientId").value,o=document.getElementById("username").value,t=document.getElementById("password").value,n=document.getElementById("error-message");""===e||""===t?(n.style.display="block",n.textContent="Por favor, preencha os campos de clientId, user e senha."):""===o?(disableAllButtons(),n.style.display="none",n.textContent="",(async()=>{await getToken(getClientTokenURL(),e,t).then((e=>{if(enableAllButtons(),e){setCookie("bearerToken",e),n.style.display="none",startDemo(new window.BrScanSDKSelfie.Selfie(e,""))}else n.style.display="block",n.textContent="Erro na autenticação",console.log("Erro na autenticação")})).catch((e=>{enableAllButtons(),n.style.display="block",n.textContent=e,console.log("err",e)}))})()):(disableAllButtons(),n.style.display="none",n.textContent="",(async()=>{await getToken(getSerasaIamUrl(e),o,t).then((e=>{if(enableAllButtons(),e){setCookie("bearerToken",e),n.style.display="none",startDemo(new window.BrScanSDKSelfie.Selfie(e,""))}else n.style.display="block",n.textContent="Erro na autenticação",console.log("Erro na autenticação")})).catch((e=>{enableAllButtons(),n.style.display="block",n.textContent=e,console.log("err",e)}))})())})),document.getElementById("tryAgain").addEventListener("click",(function(){initApp()})),document.addEventListener("DOMContentLoaded",(function(e){const o=document.createElement("script");switch(o.type="text/javascript",console.log("loaded env: ",SERASA_SDK_ENV),SERASA_SDK_ENV){case"dev":o.src="../brscan-dev-sdk-selfie-facetec.min.js";break;case"uat":o.src="../brscan-uat-sdk-selfie-facetec.min.js";break;case"prod":o.src="../brscan-sdk-selfie-facetec.min.js";break;default:alert(`Ambiente ${SERASA_SDK_ENV} não encontrado`)}o.onload=function(){initApp()},window.document.body.appendChild(o)}));